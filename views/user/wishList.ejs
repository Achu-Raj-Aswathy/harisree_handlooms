<%- include('./partials/header') %>
<%- include('./partials/userHeader') %>

  <main class="main-wrapper">

        <!-- Start Wishlist Area  -->
        <div class="axil-wishlist-area axil-section-gap">
            <div class="container">
                <div class="product-table-heading">
                    <h4 class="title">My Wish List on Harisree Handlooms</h4>
                </div>
                <div class="table-responsive">
                    <table class="table axil-product-table axil-wishlist-table">
                        <thead>
                            <tr>
                                <th scope="col" class="product-remove"></th>
                                <th scope="col" class="product-thumbnail">Product</th>
                                <th scope="col" class="product-title"></th>
                                <th scope="col" class="product-price">Unit Price</th>
                                <th scope="col" class="product-stock-status">Stock Status</th>
                                <th scope="col" class="product-add-cart"></th>
                            </tr>
                        </thead>
                        <tbody>
  <% if (wishlists.length === 0) { %>
    <tr>
      <td colspan="6" class="text-center">Your wishlist is empty.</td>
    </tr>
  <% } else { %>
    <% wishlists.forEach(item => { 
         const product = item.productId;
    %>
      <tr>
        <td class="product-remove">
          <a href="#" class="remove-from-wishlist" data-id="<%= product._id %>">
            <i class="fal fa-times"></i>
          </a>
          <!-- <a href="" class="close-btn remove-from-wishlist" data-id="<%= product._id %>">
              <i class="fas fa-times"></i>
          </a> -->
        </td>
        <td class="product-thumbnail">
          <a href="/product?id=<%= product._id %>">
            <img src="<%= product.images[0] %>" alt="<%= product.name %>" />
          </a>
        </td>
        <td class="product-title">
          <a href="/product?id=<%= product._id %>"><%= product.name %></a>
        </td>
        <td class="product-price" data-title="Price">
          â‚¹<%= product.discount || product.price %>
        </td>
        <td class="product-stock-status" data-title="Status">
          <%= product.isAvailable ? "In Stock" : "Out of Stock" %>
        </td>
        <td class="product-add-cart">
          <a href="/cart/add?id=<%= product._id %>" class="axil-btn btn-outline">Add to Cart</a>
        </td>
      </tr>
    <% }) %>
  <% } %>
</tbody>

                    </table>
                </div>
            </div>
      
        <!-- End Wishlist Area  -->
    </main>
    <%- include('./partials/footer') %>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".remove-from-wishlist").forEach((el) => {
      el.addEventListener("click", async function (e) {
        e.preventDefault();
        const productId = this.dataset.id;

        try {
          const res = await fetch(`/wishlist/remove?id=${productId}`, { method: "DELETE" });

          const data = await res.json();

          if (data.success) {
            alert("Removed from wishlist");
            window.location.reload();
          } else {
            alert(data.message || "Could not remove item.");
          }
        } catch (err) {
          console.error("Error:", err);
          alert("Something went wrong.");
        }
      });
    });
  });
</script>