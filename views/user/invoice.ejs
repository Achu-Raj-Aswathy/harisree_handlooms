<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Invoice - <%= order.orderId %></title>
<style>
    body { font-family: Arial, Helvetica, sans-serif; font-size: 14px; color: #333; }
    .header { text-align: center; margin-bottom: 20px; }
    .header h1 { margin: 0; }
    .details, .items, .summary { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    .details td { padding: 5px; vertical-align: top; }
    .items th, .items td { border: 1px solid #ccc; padding: 8px; }
    .items th { background: #f2f2f2; }
    .summary td { padding: 5px; }
    .right { text-align: right; }
    
</style>
</head>
<body>

<!-- Header -->
<div class="header">
    <h1>HARISREE HANDLOOMS</h1>
    <p>Kallanchira Peruvemba Palakkad Kerala 678531</p>
    <p>GSTIN: 32AQGPG1495F1Z4</p>
    <p>9188019689 - 9747969689</p>
    <p>harisreehandloom@gmail.com</p>
</div>

<!-- Invoice & Customer Details -->
<table class="details">
    <tr>
        <td>
            <strong>Invoice No:</strong> <%= order._id %><br>
            <strong>Order ID:</strong> <%= order.orderId %><br>
            <strong>Date:</strong> <%= new Date(order.createdAt).toLocaleDateString("en-IN") %><br>
            <strong>Payment Method:</strong> <%= order.paymentMethod %>
        </td>
        <td>
            <strong>Bill To:</strong><br>
            <%= order.address.name %><br>
            <%= order.address.line %><br>
            <%= order.address.city %>, <%= order.address.state %> <br>
            <%= order.address.country %> - <%= order.address.pincode %><br>
            <%= order.address.phone %><br>
            <%= order.address.email %>
        </td>
    </tr>
</table>

<!-- Items -->
<table class="items">
    <thead>
        <tr>
            <th>#</th>
            <th>Product</th>
            <th>HSN</th>
            <th>Qty</th>
            <th>Unit Price (₹)</th>
            <th>Subtotal (₹)</th>
        </tr>
    </thead>
    <tbody>
        <% order.items.forEach((item, index) => { %>
            <tr>
                <td><%= index + 1 %></td>
                <td><%= item.productId.name %></td>
                <td><%= item.productId.hsnCode %></td>
                <td class="right"><%= item.quantity %></td>
                <td class="right"><%= item.price.toFixed(2) %></td>
                <td class="right"><%= item.subtotal.toFixed(2) %></td>
            </tr>
        <% }) %>
    </tbody>
</table>

<!-- Summary -->
<%
    const gstRate = 0.05;
    const gstAmount = order.subtotal * gstRate;

    let cgst = 0, sgst = 0, igst = 0;
    if (order.address.state.toLowerCase() === 'kerala') {
        cgst = order.subtotal * 0.025;
        sgst = order.subtotal * 0.025;
    } else {
        igst = gstAmount;
    }
%>

<table class="summary">
    <tr>
        <td class="right"><strong>Subtotal:</strong></td>
        <td class="right">₹<%= order.subtotal.toFixed(2) %></td>
    </tr>
    <tr>
        <td class="right"><strong>Shipping:</strong></td>
        <td class="right">₹<%= order.shippingCharge.toFixed(2) %></td>
    </tr>
    <% if (cgst > 0 || sgst > 0) { %>
    <tr>
        <td class="right"><strong>CGST (2%):</strong></td>
        <td class="right">₹<%= cgst.toFixed(2) %></td>
    </tr>
    <tr>
        <td class="right"><strong>SGST (2%):</strong></td>
        <td class="right">₹<%= sgst.toFixed(2) %></td>
    </tr>
    <% } else { %>
    <tr>
        <td class="right"><strong>IGST (5%):</strong></td>
        <td class="right">₹<%= igst.toFixed(2) %></td>
    </tr>
    <% } %>
    <tr>
        <td class="right"><strong>Discount:</strong></td>
        <td class="right">-₹<%= order.discount.toFixed(2) %></td>
    </tr>
    <tr>
        <td class="right"><strong>Total:</strong></td>
        <td class="right"><strong>₹<%= order.total.toFixed(2) %></strong></td>
    </tr>
</table>

<p style="text-align:center; font-size: 12px; margin-top: 20px;">
    Thank you for supporting Indian handloom artisans!
</p>

</body>
</html>
