<body class="sticky-header overflow-md-visible">

    <a href="#top" class="back-to-top" id="backto-top"><i class="fal fa-arrow-up"></i></a>
    <!-- Start Header -->
     <header class="header axil-header header-style-7">
        <!-- <div class="header-top-campaign">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-lg-12 col-md-12 col-12">
                        <div class="header-campaign-activation axil-slick-arrow arrow-both-side header-campaign-arrow">
                            <div class="slick-slide">
                                <div class="campaign-content">
                                    <p>STUDENT NOW GET 10% OFF : <a href="#">GET OFFER</a></p>
                                </div>
                            </div>
                            <div class="slick-slide">
                                <div class="campaign-content">
                                    <p>STUDENT NOW GET 10% OFF : <a href="#">GET OFFER</a></p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div> -->
        <!-- Start Mainmenu Area  -->

        <header class="header axil-header header-style-7" style="position: fixed; top: 0; width: 100%; z-index: 1050;">
 <!-- Offer Bar - Fixed Top -->
<!-- Offer Bar -->
<div class="offer-bar" style="
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 1050;
  background-color: #B22222;
  color: white;
  font-weight: bold;
  font-size: 2rem;           /* Increased font size */
  line-height: 1.8rem;       /* Better vertical alignment */
  padding: 6px 0;            /* Slight padding for spacing */
  overflow: hidden;
  white-space: nowrap;
">
  <div style="
    display: inline-block;
    animation: scroll-left 25s linear infinite;
    padding-left: 100%;
  ">
  <%
  if(offerTag) { %>
    <span style="padding-right: 50px; display: inline-block;">
      <%= offerTag %> 
    </span>
    <% } else { %>
    <span style="padding-right: 50px; display: inline-block;">
      üéâ 100% SECURE PAYMENTS | 14 DAYS MONEY BACK GUARANTEE | EXCLUSIVE FESTIVE OFFERS üéÅ 
    </span>
    <% } %>
  </div>
</div>

<!-- Push the main header down to prevent overlap -->
<div style="height: 40px;"></div> <!-- adjust to match actual offer bar height -->

<style>
@keyframes scroll-left {
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-50%);
  }
}
</style>


</header>

<style>


.back-to-top {
  background-color: #f1c40f;  /* or any other color you want */
  border-radius: 0;           /* Makes it a square instead of a circle */
  padding: 12px 16px;         /* Adjust to make it nicely proportioned */
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  display: flex;
  justify-content: center;
  align-items: center;
  width: 50;
  height: 50px;
}

.back-to-top i {
  color: #fff;                /* Arrow color: white */
  font-size: 20px;
}

  @keyframes scroll-left {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
}
    .axil-mainmenu {
  margin-top: 32px; /* Adjust according to actual offer bar height */

  }

  
</style>

        <div id="axil-sticky-placeholder"></div>
        <div class="axil-mainmenu p-1">
            <div class="container-fluid">      
                <div class="header-navbar ">
                    <div class="header-brand d-flex">
                        <a href="/" class="logo logo-dark p-0">
                            <img src="assets/images/logo-sm.png" alt="Site Logo" class="img-fluid"
                                style="max-height: 45px;">
                        </a>
                        <a href="/" class="logo logo-dark ms-1 p-0">
                            <img src="assets/images/logo-light.png" alt="Site Logo" class="img-fluid"
                                style="max-height: 35px; ">
                        </a>
                    </div>
                    <div class="header-main-nav" style="z-index: 1050;">
                        <nav class="mainmenu-nav">
                            <button class="mobile-close-btn mobile-nav-toggler" style="    margin-right: -15px;"><i class="fas fa-times" ></i></button>
                            <div class="mobile-nav-brand">
                                <a href="/" class="logo">
                                    <img src="assets/images/logo-sm.png" alt="Site Logo">
                                    <img src="assets/images/logo-light.png" alt="Site Logo">
                                </a>
                            </div>
                            <ul class="mainmenu">
                                <li class="dropdown">
                                    <a class="dropdown-toggle" href="#" role="button" id="dropdown-header-menu"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fas fa-th-large"></i> Categories
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="dropdown-header-menu">
                                       <% if(categories) { %>

                                        <% categories.forEach ((category)=>{ %>

                                            <li class="dropdown-item" onclick="handleCategoryChange('<%= category.name %>')" ><%= category.name %> </li>

                                        <% }) %> 
                                        <% } else { %>
                                        <li>No category found</li>
                                        <% } %>
                                        
                                    </ul>

                                </li>
                                <li>
                                    <a href="/shop"><i class="fas fa-shopping-bag"></i> Shop</a>
                                </li>
                                <li>
                                    <a href="/contact"><i class="fas fa-headset"></i>Support</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                    <div class="header-action">
                        <ul class="action-list">
                            <li class="axil-search">
                                <a href="javascript:void(0)" class="header-search-icon" title="Search">
                                    <i class="fas fa-search"></i>
                                </a>
                            </li>
                             <% if(user) { %>
                            <li class="shopping-cart">
                                <a href="#" class="cart-dropdown-btn">
                                    <span class="cart-count"><%= user.cart.length %></span>
                                    <i class="fas fa-shopping-cart"></i>
                                </a>
                            </li>
                            <li class="wishlist">
                                <a href="/wishlist">
                                    <i class="fas fa-heart"></i>
                                </a>
                            </li>
                            
                           
                            <li class="my-account">
                                <a href="javascript:void(0)">
                                    <i class="far fa-user"></i>
                                </a>
                                <div class="my-account-dropdown">
                                   
                                    <ul>
                                        <li>
                                            <a href="/account"><i class="far fa-user me-3"></i>My Account</a>
                                        </li>
                                        
                                       
 
                                <li>
                                        <a href="/signout" class=" btn btn-danger">Logout</a>
                                </li>
                                  </ul>
                                </div>
                            </li>
                        <%    }  else { %>
                       <li>
                         <a href="/signin"><i class="fa-solid fa-lock"></i></a>
                       </li>
                       <% } %>

                        
                            
                            <li class="axil-mobile-toggle">
                                <button class="menu-btn mobile-nav-toggler">
                                    <i class="flaticon-menu-2"></i>
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Mainmenu Area -->
    </header>
    <!-- End Header -->
</body>





<!-- Header Search Modal End -->
<div class="header-search-modal" id="header-search-modal">
  <button class="card-close sidebar-close"><i class="fas fa-times"></i></button>
  <div class="header-search-wrap">
    <div class="card-header">
      <form onsubmit="return false;">
        <div class="input-group">
          <input
            type="search"
            class="form-control"
            id="prod-search"
            placeholder="Search for products..."
            oninput="handleSearch(this.value)"
          />
          <button type="submit" class="axil-btn btn-bg-primary">
            <i class="fal fa-search"></i>
          </button>
        </div>
      </form>
    </div>
    <div class="card-body">
      <div class="search-result-header">
        <h6 class="title" id="result-count">Search Results</h6>
        <a href="/shop" class="view-all">View All</a>
      </div>
      <div class="psearch-results" id="search-results"></div>
    </div>
  </div>
</div>

<!-- Header Search Modal End -->

<div class="cart-dropdown" id="cart-dropdown">
    <div class="cart-content-wrap">
        <div class="cart-header">
            <h2 class="header-title">Cart review</h2>
            <button class="cart-close sidebar-close"><i class="fas fa-times"></i></button>
        </div>
        <!-- <div class="cart-body">
            <ul class="cart-item-list">
                <li class="cart-item">
                    <div class="item-img">
                        <a href="/product"><img src="assets/images/product/electric/product-01.png"
                                alt="Commodo Blown Lamp"></a>
                        <button class="close-btn"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="item-content">
                        <div class="product-rating">
                            <span class="icon">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </span>
                            <span class="rating-number">(64)</span>
                        </div>
                        <h3 class="item-title"><a href="/product">Wireless PS Handler</a></h3>
                        <div class="item-price"><span class="currency-symbol">$</span>155.00</div>
                        <div class="pro-qty item-quantity">
                            <input type="number" class="quantity-input" value="15">
                        </div>
                    </div>
                </li>
                <li class="cart-item">
                    <div class="item-img">
                        <a href="/product"><img src="assets/images/product/electric/product-02.png"
                                alt="Commodo Blown Lamp"></a>
                        <button class="close-btn"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="item-content">
                        <div class="product-rating">
                            <span class="icon">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </span>
                            <span class="rating-number">(4)</span>
                        </div>
                        <h3 class="item-title"><a href="/product">Gradient Light Keyboard</a></h3>
                        <div class="item-price"><span class="currency-symbol">$</span>255.00</div>
                        <div class="pro-qty item-quantity">
                            <input type="number" class="quantity-input" value="5">
                        </div>
                    </div>
                </li>
                <li class="cart-item">
                    <div class="item-img">
                        <a href="/product"><img src="assets/images/product/electric/product-03.png"
                                alt="Commodo Blown Lamp"></a>
                        <button class="close-btn"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="item-content">
                        <div class="product-rating">
                            <span class="icon">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                            </span>
                            <span class="rating-number">(6)</span>
                        </div>
                        <h3 class="item-title"><a href="/product">HD CC Camera</a></h3>
                        <div class="item-price"><span class="currency-symbol">$</span>200.00</div>
                        <div class="pro-qty item-quantity">
                            <input type="number" class="quantity-input" value="100">
                        </div>
                    </div>
                </li>
            </ul>
        </div> -->
        <div class="cart-body">
  <ul class="cart-item-list">
    <% if (user && user.cart && user.cart.length > 0) { %>
      <% user.cart.forEach(item => {
        const product = item.productId;
        if (product) { 
      %>
        <li class="cart-item">
          <div class="item-img">
            <a href="/product?id=<%= product._id %>">
              <% if (product.images && product.images.length > 0) { %>
  <img src="<%= product.images[0] %>" alt="<%= product.name %>">
<% } else { %>
  <img src="/assets/images/placeholder.jpg" alt="No image available">
<% } %>
            </a>
            <button class="close-btn remove-from-cart" data-id="<%= product._id %>">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="item-content">
            <h3 class="item-title">
              <a href="/product?id=<%= product._id %>"><%= product.name %></a>
            </h3>
            <div class="item-price">‚Çπ<%= product.discount || product.price %></div>
            <!-- Optionally show quantity if implemented -->
          </div>
        </li>
        <%  } %>
      <% }) %>
    <% } else { %>
      <li class="cart-item text-center">
        <p>Your cart is empty.</p>
      </li>
    <% } %>
  </ul>
</div>
        <!-- <div class="cart-footer">
            <h3 class="cart-subtotal">
                <span class="subtotal-title">Subtotal:</span>
                <span class="subtotal-amount">$610.00</span>
            </h3>
            <div class="group-btn">
                <a href="/cart" class="axil-btn btn-bg-primary viewcart-btn">View Cart</a>
                <a href="/checkout" class="axil-btn btn-bg-secondary checkout-btn">Checkout</a>
            </div>
        </div> -->
        <%
  let subtotal = 0;
  if (user && user.cart && user.cart.length > 0) {
    user.cart.forEach(item => {
    if (item.productId) {
      const price = item.productId.discount || item.productId.price || 0;
      subtotal += price;
    }
    });
  }
%>

<div class="cart-footer">
  <h3 class="cart-subtotal">
    <span class="subtotal-title">Subtotal:</span>
    <span class="subtotal-amount">‚Çπ<%= subtotal %></span>
  </h3>
  <div class="group-btn">
      <a href="/cart" class="axil-btn btn-bg-primary viewcart-btn">View Cart</a>
  <form id="mini-cart-checkout-form" action="/checkout" method="POST">
    <input type="hidden" name="cartData" id="miniCartDataInput">
    <a href="#" class="axil-btn btn-bg-secondary checkout-btn w-100" id="miniCartCheckoutBtn">Checkout</a>
  </form>
</div>

</div>
    </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".remove-from-cart").forEach((el) => {
    el.addEventListener("click", async function (e) {
      e.preventDefault();
      const productId = this.dataset.id;

      try {
        const res = await fetch(`/cart/remove?id=${productId}`, { method: "DELETE" });
        const data = await res.json();

        if (data.success) {
          Swal.fire({
            icon: "success",
            title: "Removed!",
            text: "Item removed from cart.",
            timer: 1500,
            showConfirmButton: false
          }).then(() => {
            window.location.reload();
          });
        } else {
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: data.message || "Could not remove item."
          });
        }
      } catch (err) {
        console.error("Error:", err);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "Something went wrong."
        });
      }
    });
  });
});

</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const checkoutBtn = document.getElementById("miniCartCheckoutBtn");
  const hiddenInput = document.getElementById("miniCartDataInput");
  const form = document.getElementById("mini-cart-checkout-form");

  if (checkoutBtn && form && hiddenInput) {
    checkoutBtn.addEventListener("click", function (e) {
      e.preventDefault();

      const cartItems = [];
      let total = 0;

      document.querySelectorAll(".cart-item").forEach(itemEl => {
        const productId = itemEl.querySelector(".remove-from-cart")?.dataset.id; // ‚úÖ From close button
        const name = itemEl.querySelector(".item-title a")?.textContent.trim();
        const priceText = itemEl.querySelector(".item-price")?.textContent.replace(/[‚Çπ\s]/g, "") || "0";
        const price = parseFloat(priceText);
        
        // Default quantity is 1 (unless you store per-item quantity elsewhere)
        const quantity = 1;

        cartItems.push({
          productId: productId,
          name,
          quantity,
          price,
          subtotal: (price * quantity).toFixed(2)
        });

        total += price * quantity;
      });

      const cartData = {
        items: cartItems,
        total: total.toFixed(2)
      };

      hiddenInput.value = JSON.stringify(cartData);
      form.submit();
    });
  }
});
</script>

<script>
  async function handleSearch(query) {
    if (query.trim().length === 0) {
      document.getElementById("search-results").innerHTML = "";
      document.getElementById("result-count").textContent = "No results";
      return;
    }

    try {
      // Replace with your backend endpoint
      const response = await fetch(`/api/search?query=${encodeURIComponent(query)}`);
      const products = await response.json();

      const resultContainer = document.getElementById("search-results");
      const resultCount = document.getElementById("result-count");
      resultCount.textContent = `${products.length} Result(s) Found`;

      resultContainer.innerHTML = products
        .map(
          (product) => `
        <div class="axil-product-list">
          <div class="thumbnail">
            <a href="/product?id=${product._id}">
             <img src="${product.images[0]}" alt="${product.name}" style="width: 80px; height: auto;" />

            </a>
          </div>
          <div class="product-content">
           
            <h6 class="product-title"><a href="/product?id=${product._id}">${product.name}</a></h6>
            <div class="product-price-variant">
              <span class="price current-price">‚Çπ ${product.discount}</span>
              ${
                product.price
                  ? `<span class="price old-price">‚Çπ ${product.price}</span>`
                  : ""
              }
            </div>
         <div class="product-cart" style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
  <a href="#" class="cart-btn add-to-cart" data-id="${product._id}" style="padding: 8px; border: 1px solid #eee; border-radius: 8px;">
    <i class="fal fa-shopping-cart"></i>
  </a>
  <a href="#" class="wishlist-btn add-to-wishlist" data-id="${product._id}">
    <i class="fal fa-heart"></i>
  </a>
</div>


          </div>
        </div>
        `
        )
        .join("");
    } catch (err) {
      console.error("Search error:", err);
    }
  }
</script>
 

<script>
  document.addEventListener("DOMContentLoaded", function () {
  document.body.addEventListener("click", async function (e) {
    // üõí Handle Add to Cart
    const cartBtn = e.target.closest(".add-to-cart");
    if (cartBtn) {
      e.preventDefault();
      const productId = cartBtn.dataset.id;

      try {
        const res = await fetch(`/cart/add?id=${productId}`, { method: "POST" });
        const data = await res.json();
        if (data.success) {
          Swal.fire({
            icon: "success",
            title: "Added to Cart!",
            text: "Product has been added to your cart.",
            timer: 1500,
            showConfirmButton: false
          }).then(() => window.location.reload());
        } else {
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: data.message || "Failed to add to cart."
          });
        }
      } catch (err) {
        console.error("Error adding to cart:", err);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "Something went wrong."
        });
      }
      return;
    }

    // ‚ù§Ô∏è Handle Add to Wishlist
    const wishlistBtn = e.target.closest(".add-to-wishlist");
    if (wishlistBtn) {
      e.preventDefault();
      const productId = wishlistBtn.dataset.id;

      try {
        const res = await fetch(`/wishlist/add?id=${productId}`, { method: "POST" });
        const data = await res.json();
        if (data.success) {
          Swal.fire({
            icon: "success",
            title: "Added to Wishlist!",
            text: "Product has been added to your wishlist.",
            timer: 1500,
            showConfirmButton: false
          }).then(() => window.location.reload());
        } else {
          Swal.fire({
            icon: "error",
            title: "Oops...",
            text: data.message || "Could not add to wishlist."
          });
        }
      } catch (err) {
        console.error("Error adding to wishlist:", err);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "Something went wrong."
        });
      }
    }
  });
});

</script>
<script>
  function handleCategoryChange(category) {
  if (category) {
    window.location.href = `/shop?category=${encodeURIComponent(category)}`;
  } else {
    window.location.href = `/shop`;
  }
}
</script>
        