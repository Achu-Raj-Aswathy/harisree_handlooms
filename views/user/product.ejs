<%- include('./partials/header') %>
  <%- include('./partials/userHeader') %>
    <main class="main-wrapper">
      <!-- Start Shop Area  -->
      <div class="axil-single-product-area bg-color-white">
        <div class="single-product-thumb axil-section-gap pb--20 pb_sm--0 bg-vista-white">

          <div class="container">
            <div class="row row--25 align-items-center">
              <!-- üñºÔ∏è Image Slider - LEFT (Desktop) -->
              <div class="col-lg-5 mb--40">
                <div class="position-sticky sticky-top">
                  <div class="product-image-slider mb-4">

                    <!-- üñºÔ∏è Image Slider -->
                    <% if (product.images && product.images.length> 0) { %>
                      <% product.images.forEach(image=> { %>
                        <div style="display: flex; justify-content: center; align-items: center;">

                          <img class="img-fluid object-cover" src="<%= image %>" alt="<%= product.name %>"
                            style="border-radius: 10px; height: 400px; width: 300px; " />
                        </div>
                        <% }) %>
                          <% } else { %>
                            <div>
                              <img class="img-fluid w-100" src="/assets/images/placeholder.jpg" alt="No Image Available"
                                style="border-radius: 10px;" />
                            </div>
                            <% } %>

                  </div>
                </div>
              </div>

              <!-- üìù Product Info - RIGHT (Desktop) -->
              <div class="col-lg-7 mb--40">
                <div class="single-product-content">
                  <div class="inner">
                    <h2 class="product-title">
                      <%= product.name %>
                    </h2>
                    <span class="price-amount"><span style="text-decoration: line-through; color: grey">‚Çπ<%=
                          product.price %></span>&nbsp;‚Çπ<%= product.discount %></span>
                   <!-- ‚≠ê Overall Rating Display (Place this here) -->
    

                    <ul class="product-meta mb-3">
                      <li><i class="fal fa-check"></i> In stock</li>
                      <li><i class="fal fa-check"></i> Free delivery available</li>
                      <!-- <li><i class="fal fa-check"></i> Sales 30% Off Use Code: <strong>MOTIVE30</strong></li> -->
                    </ul>

                    <p class="description mb-4">
                      <%= product.description %>
                    </p>

                    <h6>Product Details</h6>
                    <ul class="list-unstyled">
                      <li><span>Length: </span>
                        <%= product.length %>
                      </li>
                    <% if (product.blouseDetails && product.blouseDetails.toLowerCase() !== "nil") { %>
  <li>
    <span>Blouse Details: </span>
    <%= product.blouseDetails %>
  </li>
<% } %>


                    <li><span>Fabric: </span>
                        <%= product.fabric %>
                      </li>

                   <% if (product.design && product.design.toLowerCase() !== "nil") { %>
  <li>
    <span>Design: </span>
    <%= product.design %>
  </li>
<% } %>


                      <li><span>Colour: </span>
                        <%= product.colour %>
                      </li>
                    </ul>

                    <!-- üé® Variants -->


                    <!-- üõí Actions -->
                    <!-- ‚≠ê Stylish Single-Row Action Panel -->
                    <div class="product-action-wrapper mt-4">
                      <div class="d-flex flex-row flex-wrap align-items-center justify-content-start gap-3">

                        <!-- üì¶ Quantity Selector -->
                        <!-- üì¶ Quantity Selector -->
                        <div class="d-flex align-items-center border rounded-pill px-3 py-1 bg-light"
                          style="height: 44px;">
                          <button class="btn btn-sm px-2 py-0 border-0 bg-transparent" onclick="adjustQty(-1)">
                            <i class="fas fa-minus"></i>
                          </button>
                          <span id="qty-value" class="mx-3 fw-bold"
                            style="min-width: 20px; text-align: center; font-size: 16px; color: #000;">1</span>
                          <button class="btn btn-sm px-2 py-0 border-0 bg-transparent" onclick="adjustQty(1)">
                            <i class="fas fa-plus"></i>
                          </button>
                        </div>


                        <!-- üõçÔ∏è Buy Now -->
                        <a href="/cart" class="btn btn-danger fw-semibold px-4 py-2 rounded-pill"
                          style="height: 44px; display: flex; align-items: center;">
                          Buy Now
                        </a>


                        <!-- ‚ù§Ô∏è Wishlist -->
                        <button
                          class="add-to-wishlist btn btn-outline-dark rounded-circle d-flex align-items-center justify-content-center"
                          style="width: 44px; height: 44px"; data-id="<%=product._id %>">
                          <i class="fas fa-heart text-danger"></i></button>

                        <!-- üõí Add to Cart -->
                        <button data-id="<%= product._id %>"
                          class="add-to-cart btn btn-outline-dark rounded-circle d-flex align-items-center justify-content-center"
                          style="width: 44px; height: 44px;">
                          <i class="fas fa-cart-plus"></i>
                        </button>

                      </div>
                    </div>

                    <!-- üì¢ Customer Reviews -->
                    <!-- Review Form -->
                   <!-- ‚≠ê Submit Review Form -->
<form id="reviewForm" action="/product/<%= product._id %>/review" method="POST" enctype="multipart/form-data">
  <div class="form-group mt-5">
    <div class="d-flex justify-content-between">
      <div class="rating-container d-flex">
        <p>Rate Your Product:</p>
        <div id="overallRating-stars">
          <% for(let i = 1; i <= 5; i++) { %>
            <span class="star" onclick="setRating('overallRating', <%= i %>)">‚òÖ</span>
          <% } %>
        </div>
        <input type="hidden" id="overallRating" name="rating" required />
      </div>
      <div class="toggle-bar">
        <a href="javascript:void(0)" class="toggle-btn-write">Write a Review..?</a>
      </div>
    </div>

    <div class="toggle-open-write">
      <div class="form-group mt-4">
        <p>Your Review</p>
        <textarea id="review" name="comment" class="form-control" rows="4" placeholder="Write your experience..."></textarea>
      </div>

      <div class="form-group">
        <p>Upload Images</p>
        <input type="file" name="images" class="form-control" multiple />
      </div>

      <ul class="list-inline mt-4">
        <li class="list-inline-item">
          <button type="submit" class="btn btn-success">Submit</button>
        </li>
        <li class="list-inline-item">
          <button type="reset" class="btn btn-danger">Cancel</button>
        </li>
      </ul>
    </div>
  </div>
</form>



                   <div class="form-group  mt-5">
                        <div class="d-flex justify-content-between">
                          <div class="rating-container d-flex">
                            <p>Overall Rating:</p>
                            <div class="d-flex">
  <% for (let i = 1; i <= 5; i++) { %>
    <i class="fa-star <%= i <= Math.round(avgRating) ? 'fas text-warning' : 'far text-muted' %>"></i>
  <% } %>
</div>

                            <!-- <div id="overallRating-stars">
                              <span class="star" onclick="setRating('overallRating', 1)">‚òÖ</span>
                              <span class="star" onclick="setRating('overallRating', 2)">‚òÖ</span>
                              <span class="star" onclick="setRating('overallRating', 3)">‚òÖ</span>
                              <span class="star" onclick="setRating('overallRating', 4)">‚òÖ</span>
                              <span class="star" onclick="setRating('overallRating', 5)">‚òÖ</span>
                            </div> -->
                            <input type="hidden" id="overallRating" name="overallRating" required />
                          </div>

                          <div class="toggle-bar">
                            <a href="javascript:void(0)" class="toggle-btn-view">
                              View Reviews..!
                            </a>
                          </div>

                        </div>

                        <div class="toggle-open-view">

                          <!-- ‚≠ê View Reviews -->
<div class="form-group">
  <h4>Customer Reviews</h4>
  <% if (reviews && reviews.length > 0) { %>
  <% reviews.forEach(review => { %>
    <div class="border p-3 mb-3 rounded shadow-sm bg-light">
      <strong>‚≠ê <%= review.rating %>/5</strong>
      <p class="mb-1"><%= review.review %></p>
      <% if (review.images && review.images.length > 0) { %>
        <div class="d-flex gap-2 flex-wrap mt-2">
          <% review.images.forEach(img => { %>
            <img src="<%= img %>" alt="Review Image" style="height: 80px; width: auto; border-radius: 5px;" />
          <% }) %>
        </div>
      <% } %>
    </div>
  <% }) %>
<% } else { %>
  <p>No reviews yet. Be the first to review!</p>
<% } %>

</div>
                        </div>
                      </div>
                   <style>
  .rating-container {
    align-items: center;
    gap: 10px;
  }

  .rating-container p {
    margin: 0;
    font-weight: 500;
  }

  #overallRating-stars .star {
    font-size: 20px;
    color: #ccc;
    cursor: pointer;
    margin-left: 5px;
  }

  #overallRating-stars .star.selected {
    color: gold;
  }

  .toggle-open {
    display: none;
  }

  .toggle-open.show {
    display: block;
    animation: fadeIn 0.3s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>


<style>
  .toggle-open-write,
  .toggle-open-view {
    display: none;
  }

  .toggle-open-write.show,
  .toggle-open-view.show {
    display: block;
    animation: fadeIn 0.3s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .rating-container {
    align-items: center;
    gap: 10px;
  }

  .rating-container p {
    margin: 0;
    font-weight: 500;
  }

  #overallRating-stars .star {
    font-size: 20px;
    color: #ccc;
    cursor: pointer;
    margin-left: 5px;
  }

  #overallRating-stars .star.selected {
    color: gold;
  }
</style>

                </div>
              </div>
            </div>
          </div>

          <!-- End Shop Area  -->
  <% if (recentlyViewedProducts && recentlyViewedProducts.length > 0) { %>
  <div class="axil-new-arrivals-product-area fullwidth-container flash-sale-area section-gap-80-35">
    <div class="container ml--xxl-0">
      <div class="section-title-border slider-section-title">
        <h2 class="title">Recently Viewed üí•</h2>
      </div>
      <div class="recently-viwed-activation slick-layout-wrapper--15 axil-slick-angle angle-top-slide">
        <% recentlyViewedProducts.forEach(product => { %>
          <div class="slick-single-layout">
            <div class="axil-product product-style-eight">
              <div class="thumbnail">
                <a href="/product/<%= product._id %>">
                  <% if (product.images && product.images.length > 0) { %>
                    <img class="main-img" src="<%= product.images[0] %>" alt="<%= product.name || 'Product' %>">
                  <% } else { %>
                    <img class="main-img" src="/images/placeholder.png" alt="No image available">
                  <% } %>
                </a>
                <% if (product.discount > 0) { %>
                  <div class="label-block label-left">
                    <div class="product-badget sale">Sale</div>
                  </div>
                <% } %>
                <div class="product-hover-action">
                  <ul class="cart-action">
                    <li class="select-option">
                      <a href="/product/<%= product._id %>">
                        <i class="far fa-shopping-cart"></i> Add to Cart
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="product-content">
                <div class="inner">
                  <h5 class="title">
                    <a href="/product/<%= product._id %>"><%= product.name || 'Untitled' %></a>
                  </h5>
                  <div class="product-price-variant">
                    <% if (product.discount && product.discount > 0) { 
                         const discounted = (product.price - (product.price * product.discount / 100)).toFixed(2); %>
                      <span class="price old-price">‚Çπ<%= product.price %></span>
                      <span class="price current-price">‚Çπ<%= discounted %></span>
                    <% } else { %>
                      <span class="price current-price">‚Çπ<%= product.price %></span>
                    <% } %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% }); %>
      </div>
    </div>
  </div>
<% } else { %>
  <div class="container text-center py-5">
    <h4>No recently viewed products üòî</h4>
  </div>
<% } %>





    </main>

   <script>
  $('.recently-viwed-activation').slick({
    infinite: false,
    slidesToShow: 4,
    slidesToScroll: 1,
    arrows: true,
    responsive: [
      {
        breakpoint: 992,
        settings: { slidesToShow: 2 }
      },
      {
        breakpoint: 768,
        settings: { slidesToShow: 1 }
      }
    ]
  });
</script>



    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>

    <script>
      $(document).ready(function () {
        $('.product-image-slider').slick({
          slidesToShow: 1,
          slidesToScroll: 1,
          arrows: true,
          dots: true,
          autoplay: true,
          autoplaySpeed: 3000,
          adaptiveHeight: true
        });
      });


    </script>

    <script>
      function adjustQty(change) {
        const qtySpan = document.getElementById("qty-value");
        let currentQty = parseInt(qtySpan.innerText);
        if (!isNaN(currentQty)) {
          const newQty = Math.max(1, currentQty + change);
          qtySpan.innerText = newQty;
        }
      }
    </script>

    <!-- <script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".add-to-wishlist").forEach((el) => {
      el.addEventListener("click", async function (e) {
        e.preventDefault();

        const productId = this.dataset.id;

        try {
          const res = await fetch(`/wishlist/add?id=${productId}`, {
            method: "POST",
          });

          const data = await res.json();

          if (data.success) {
            // Optionally change the icon or give user feedback
            alert("Added to wishlist!");
            window.location.reload(); // Or just update the icon/UI
          } else {
            alert(data.message || "Could not add to wishlist.");
          }
        } catch (error) {
          console.error("Error adding to wishlist:", error);
          alert("Something went wrong.");
        }
      });
    });
  });
</script> -->

    <!-- <script>
  function adjustQty(change) {
    const qtySpan = document.getElementById("qty-value");
    let currentQty = parseInt(qtySpan.innerText);
    if (!isNaN(currentQty)) {
      const newQty = Math.max(1, currentQty + change);
      qtySpan.innerText = newQty;
    }
  }

  function toggleWishlist() {
    const icon = document.getElementById("wishlistIcon");
    const btn = document.getElementById("wishlistBtn");

    if (icon.classList.contains("far")) {
      icon.classList.remove("far");
      icon.classList.add("fas");
      alert("Added to wishlist!");
    } else {
      icon.classList.remove("fas");
      icon.classList.add("far");
      alert("Removed from wishlist!");
    }
  }
</script> -->


    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".add-to-wishlist").forEach((el) => {
          el.addEventListener("click", async function (e) {
            e.preventDefault();

            const productId = this.dataset.id;

            try {
              const res = await fetch(`/wishlist/add?id=${productId}`, {
                method: "POST",
              });

              const data = await res.json();

              if (data.success) {
                // Optionally change the icon or give user feedback
                alert("Added to wishlist!");
                window.location.reload(); // Or just update the icon/UI
              } else {
                alert(data.message || "Could not add to wishlist.");
              }
            } catch (error) {
              console.error("Error adding to wishlist:", error);
              alert("Something went wrong.");
            }
          });
        });
      });
    </script>
    <script>

      document.addEventListener("DOMContentLoaded", function () {
        // Add to Cart
        document.querySelectorAll(".add-to-cart").forEach((el) => {
          el.addEventListener("click", async function (e) {
            e.preventDefault();

            const productId = this.dataset.id;

            try {
              const res = await fetch(`/cart/add?id=${productId}`, {
                method: "POST",
              });

              const data = await res.json();

              if (data.success) {
                alert("Product added to cart!");
                // You can also reload or update cart count here
                window.location.reload(); // Or just update the icon/UI
              } else {
                alert(data.message || "Failed to add to cart.");
              }
            } catch (err) {
              console.error("Error adding to cart:", err);
              alert("Something went wrong.");
            }
          });
        });
      });
    </script>


    <script>
      // ‚≠ê Toggle review form
      document.querySelector(".toggle-btn").addEventListener("click", function () {
        document.querySelector(".toggle-open").classList.toggle("show");
      });

      // ‚≠ê Star rating selection
      function setRating(fieldId, rating) {
        const starContainer = document.getElementById(fieldId + "-stars");
        const stars = starContainer.querySelectorAll(".star");

        stars.forEach((star, index) => {
          if (index < rating) {
            star.classList.add("selected");
          } else {
            star.classList.remove("selected");
          }
        });

        document.getElementById(fieldId).value = rating;
      }
    </script>

<script>
  // ‚≠ê Toggle "Write a Review"
  document.querySelector(".toggle-btn-write").addEventListener("click", function () {
    document.querySelector(".toggle-open-write").classList.toggle("show");
  });

  // ‚≠ê Toggle "View Reviews"
  document.querySelector(".toggle-btn-view").addEventListener("click", function () {
    document.querySelector(".toggle-open-view").classList.toggle("show");
  });

  // ‚≠ê Star rating selection
  function setRating(fieldId, rating) {
    const starContainer = document.getElementById(fieldId + "-stars");
    const stars = starContainer.querySelectorAll(".star");

    stars.forEach((star, index) => {
      if (index < rating) {
        star.classList.add("selected");
      } else {
        star.classList.remove("selected");
      }
    });

    document.getElementById(fieldId).value = rating;
  }
</script>


    <%- include('./partials/footer') %>
      </div>