<%- include('./partials/header') %>
<div class="wrapper">
  <%- include('./partials/adminHeader') %>
  <%- include('./partials/sidebar') %>

  <div class="page-content">
    <div class="container-xxl">
      <div class="row">
        <div class="col-xl-12 col-lg-12">
          <form id="CategoryForm" action="/admin/add-product" method="post" enctype="multipart/form-data">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">Add Product Photo</h4>
              </div>
              <div class="card-body">
                <input type="file" name="thumbnail[]" class="filepond" multiple
                  data-max-file-size="3MB" data-max-files="5"
                  accept="image/png, image/jpeg, image/gif" />
                <small class="text-muted fs-13 d-block mt-2">
                  1600 x 1200 (4:3) recommended. PNG and JPG files are allowed.
                </small>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h4 class="card-title">Product Information</h4>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label for="productId" class="form-label">Product ID</label>
                      <input type="text" id="productId" name="productId" class="form-control" disabled
                        value="<%= productId %>">
                      <input type="hidden" name="productId" value="<%= productId %>">
                    </div>
                  </div>

                  <div class="col-lg-6">
                    <div class="mb-3">
                      <label for="categoryId" class="form-label">Select Category</label>
                      <select id="categoryId" name="categoryId" class="form-select" required>
                        <option value="">-- Choose a Category --</option>
                        <% categories.forEach(function(category) { %>
                          <option value="<%= category.categoryId %>"><%= category.name %></option>
                        <% }); %>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-lg-8">
                    <div class="mb-3">
                      <label for="product-name" class="form-label">Product Name</label>
                      <input type="text" name="productName" id="product-name" class="form-control"
                        placeholder="Item Name">
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="mb-3">
                      <label for="hsnCode" class="form-label">HSN Code</label>
                      <input type="text" name="hsnCode" id="hsnCode" class="form-control" placeholder="HSN Code">
                    </div>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-lg-4">
                    <label for="specification" class="form-label">Specifications</label>
                    <select class="form-control" name="specification" id="specification">
                      <option value="Not Applicable">Not Applicable</option>
                      <option value="With Blouse">With Blouse</option>
                      <option value="Without Blouse">Without Blouse</option>
                    </select>
                  </div>

                  <div class="col-lg-4">
                    <label for="gender" class="form-label">Gender</label>
                    <select class="form-control" name="gender" id="gender">
                      <option value="">Select Gender</option>
                      <option value="Men">Men</option>
                      <option value="Women">Women</option>
                      <option value="Boys">Boys</option>
                      <option value="Girls">Girls</option>
                      <option value="Unisex">Unisex</option>
                    </select>
                  </div>

                  <div class="col-lg-4">
                    <label for="size" class="form-label">Size</label>
                    <select class="form-control" name="size" id="size">
                      <option value="Free Size">Free Size</option>
                      <option value="2 Meters">2 Meters</option>
                      <option value="4 Meters">4 Meters</option>
                      <option value="6.25 Meters">6.25 Meters</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <div class="col-lg-4">
                    <div class="mb-3">
                      <label for="skuId" class="form-label">SKU ID</label>
                      <input type="text" name="skuId" id="skuId" class="form-control" placeholder="">
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="mb-3">
                      <label for="stock" class="form-label">Total Stock</label>
                      <input type="text" name="stock" id="stock" class="form-control" placeholder="">
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="mb-3">
                      <label for="lowStockAlert" class="form-label">Low Stock Alert</label>
                      <input type="text" name="lowStockAlert" id="lowStockAlert" class="form-control" placeholder="">
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-lg-12">
                    <div class="mb-3">
                      <label for="description" class="form-label">Description</label>
                      <textarea class="form-control bg-light-subtle" name="description" id="description" rows="7"
                        placeholder="Short description about the product"></textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h4 class="card-title">Pricing Details</h4>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-lg-6">
                    <label for="price" class="form-label">Price</label>
                    <div class="input-group mb-3">
                      <span class="input-group-text fs-15">Rs: </span>
                      <input type="number" name="price" id="price" class="form-control" placeholder="000">
                    </div>
                  </div>

                  <div class="col-lg-6">
                    <label for="discount" class="form-label">Discount</label>
                    <div class="input-group mb-3">
                      <span class="input-group-text fs-20"><i class='bx bxs-discount'></i></span>
                      <input type="number" name="discount" id="discount" class="form-control" placeholder="000">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="p-3 bg-light mb-3 rounded">
              <div class="row justify-content-end g-2">
                <div class="col-lg-2">
                  <button type="submit" class="btn btn-outline-secondary w-100">Create Product</button>
                </div>
                <div class="col-lg-2">
                  <button type="reset" class="btn btn-primary w-100">Cancel</button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <%- include('./partials/footer') %>
  </div>
</div>

<!-- ✅ FilePond Styles -->
<link href="https://unpkg.com/filepond@^4/dist/filepond.css" rel="stylesheet" />
<link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css" rel="stylesheet" />

<!-- ✅ FilePond Scripts -->
<script src="https://unpkg.com/filepond@^4/dist/filepond.js"></script>
<script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>

<script>
  FilePond.registerPlugin(FilePondPluginImagePreview);

  const pond = FilePond.create(document.querySelector('.filepond'), {
    allowMultiple: true,
    maxFiles: 5,
    imagePreviewHeight: 170,
    acceptedFileTypes: ['image/png', 'image/jpeg', 'image/gif'],
    labelIdle: 'Drag & Drop your images or <span class="filepond--label-action">Browse</span>'
  });

  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("CategoryForm");

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const formData = new FormData(form);

      // Add FilePond files
      pond.getFiles().forEach(fileItem => {
        formData.append("thumbnail[]", fileItem.file);
      });

      fetch(form.action, {
        method: "POST",
        body: formData,
      })
        .then(response => response.json())
        .then(data => {
          console.log("Success:", data);
          alert("Product added successfully!");
        })
        .catch(error => {
          console.error("Error:", error);
          alert("Failed to add product.");
        });
    });
  });
</script>

<style>
  .filepond--item {
    width: calc(25% - 0.5em);
  }

  .filepond--list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5em;
  }
</style>
