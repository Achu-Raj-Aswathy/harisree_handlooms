<%- include('./partials/header') %>

  <div class="wrapper">
    <%- include('./partials/adminHeader') %>
      <%- include('./partials/sidebar') %>

        <div class="page-content">
          <div class="container-fluid">
            
            <div class="row">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2 class="text-danger fw-bold">üéÅ Offer List</h2>
              <a href="/admin/add-offers" class="btn btn-primary fw-semibold">‚ûï Add Offer</a>
            </div>

            <!-- üîß MOCK STATIC DATA since backend is not working -->
            <div class="table-responsive">
              <table class="table table-bordered table-striped align-middle">
                <thead class="table-dark">
                  <tr>
                    <th>#</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Discount (%)</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Image</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
               <% if (offers.length > 0) { %>
  <% offers.forEach((offer, index) => { %>
    <tr>
      <td><%= index + 1 %></td>
      <td><%= offer.name %></td>
      <td><%= offer.description %></td>
      <td><%= offer.discountPercentage %> %</td>
      <td><%= offer.startDate.toISOString().slice(0, 10) %></td>
      <td><%= offer.endDate.toISOString().slice(0, 10) %></td>
      <td>
       <% if (offer.image) { %>
  <img src="/uploads/<%= offer.image %>" alt="Offer Image" class="avatar-md" />
<% } else { %>
  <img src="/assets/images/default.jpg" alt="Default Image" class="avatar-md" />
<% } %>

      </td>
      <td>
        <a href="/admin/edit-offer?id=<%= offer._id %>" class="btn btn-sm btn-warning mb-1">‚úèÔ∏è Edit</a>
        <button 
  type="button" 
  class="btn btn-sm btn-danger delete-offer-btn" 
  data-offer-id="<%= offer._id %>"
>
  üóëÔ∏è Delete
</button>

      </td>
    </tr>
                       
  <% }) %>
<% } else { %>
  <tr><td colspan="8" class="text-center">No offers found</td></tr>
<% } %>


                </tbody>
              </table>
            </div>

          </div>
          </div>
          <!-- End Container Fluid -->

          <%- include('./partials/footer') %>
        </div>
  </div>

    <style>
      .content-area {
        margin-left: 250px;
        padding: 2rem;
        transition: margin-left 0.3s ease;
      }

      @media (max-width: 768px) {
        .content-area {
          margin-left: 0 !important;
          padding: 1rem;
        }
      }
    </style>

 <script>
  document.querySelectorAll('.delete-offer-btn').forEach(button => {
    button.addEventListener('click', async function () {
      const offerId = this.dataset.offerId;

      Swal.fire({
        title: 'Are you sure?',
        text: 'This action will permanently delete the offer!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!'
      }).then(async (result) => {
        if (result.isConfirmed) {
          try {
            const response = await fetch(`/admin/delete-offer/${offerId}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              }
            });

            if (response.ok) {
              Swal.fire({
                icon: 'success',
                title: 'Deleted!',
                text: 'Offer deleted successfully.',
                showConfirmButton: false,
                timer: 1500
              });

              // Optionally remove row/card
              this.closest('.offer-row')?.remove();
              // Or refresh page
              // location.reload();
            } else {
              Swal.fire('Failed!', 'Failed to delete offer.', 'error');
            }
          } catch (error) {
            console.error('Delete failed:', error);
            Swal.fire('Error!', 'Something went wrong.', 'error');
          }
        }
      });
    });
  });
</script>

